<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mandatos Presidenciales en América Latina y el Caribe</title>
    <style>
        :root {
            --primary: #1A54EB;    /* Blue */
            --secondary: #00ADDC;  /* Turquoise */
            --accent: #FF5C59;     /* Red */
            --background: #F7F5F0; /* Off White */
            --text: #000000;       /* Deep Black */
            --card: #FFFFFF;       /* White */
            --highlight: #FF9700;  /* Orange */
            --muted: #99A0BE;      /* Light Grey */
            --dark: #00115B;       /* Dark Blue */
            --alternate: #66719B;  /* Blue Grey */
            --shadow: rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --background: #121212;
            --card: #1E1E1E;
            --text: #FFFFFF;
            --muted: #333333;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background-color: var(--card);
            border-radius: 10px;
            box-shadow: 0 4px 6px var(--shadow);
        }

        h1 {
            color: var(--dark);
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--alternate);
            font-weight: normal;
            font-size: 1.2rem;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        /* Add search bar styles */
        .search-container {
            flex: 1;
            max-width: 300px;
            margin-right: 20px;
        }

        .search-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--primary);
            border-radius: 4px;
            background: var(--card);
            color: var(--text);
        }

        .sort-options {
            display: flex;
            gap: 10px;
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
            transform: scale(1);
        }

        button:hover {
            background-color: var(--secondary);
            box-shadow: 0 4px 8px var(--shadow);
        }

        button.active {
            background-color: var(--accent);
        }

        button:active {
            transform: scale(0.95);
        }

        .last-updated {
            font-size: 0.9rem;
            color: var(--alternate);
        }

        /* Improve grid layout */
        .presidents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            grid-gap: 25px;
            scroll-behavior: smooth;
        }

        /* Enhanced card styles */
        .president-card {
            background: var(--card);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 16px var(--shadow);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .president-card.ending-soon {
            background: rgba(255, 92, 89, 0.1); /* Color rojo claro con transparencia */
            border: 1px solid var(--accent);
        }

        .president-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .president-card:hover::before {
            transform: scaleX(1);
        }

        .president-card:hover {
            transform: translateY(-5px);
        }

        .president-card:active {
            transform: scale(0.98);
        }

        .president-tooltip {
            position: absolute;
            background: var(--dark);
            color: white;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9rem;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
            z-index: 100;
            width: 200px;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 4px 8px var(--shadow);
        }

        .president-card:hover .president-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .country-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .country-name {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .govt-type {
            background-color: rgba(227, 229, 236, 0.5); 
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .president-info {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .president-name {
            font-weight: 500;
        }

        .time-remaining {
            font-weight: bold;
            text-align: right;
            color: var(--primary);
        }

        .progress-container {
            height: 20px;
            background-color: var(--muted);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 1s ease-in-out;
            background: linear-gradient(90deg, var(--secondary) 0%, var(--primary) 100%);
        }

        .percentage {
            font-size: 0.9rem;
            text-align: right;
            color: var(--alternate);
        }

        .expired {
            color: var(--accent);
        }

        /* Estilos para el filtro de países */
        .filter-container {
            background-color: var(--card);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px var(--shadow);
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .filter-title {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--dark);
        }

        .filter-actions {
            display: flex;
            gap: 10px;
        }

        .country-filter {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .country-filter.show {
            max-height: 500px;
            overflow-y: auto;
        }

        .country-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .country-checkbox input {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--primary);
            transition: transform 0.2s;
        }

        .country-checkbox input:checked {
            transform: scale(1.1);
        }

        .country-checkbox input:focus + label {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        .country-checkbox label {
            cursor: pointer;
        }

        .region-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .region-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .region-option input {
            accent-color: var(--primary);
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: flex-start;
            }

            .country-header, .president-info {
                flex-direction: column;
                align-items: flex-start;
            }

            .time-remaining {
                text-align: left;
                margin-top: 5px;
            }

            .country-filter {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }

        footer {
            margin-top: 40px;
            text-align: center;
            font-size: 0.9rem;
            color: var(--alternate);
        }

        /* Estilos adicionales para resaltar información importante */
        .highlight-info {
            background-color: var(--highlight);
            color: white;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .loading {
            background: linear-gradient(90deg, 
                var(--background) 25%, 
                var(--muted) 50%, 
                var(--background) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        .theme-switch {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 5px var(--shadow);
            color: white;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-switch:hover {
            background: var(--secondary);
        }

        /* Add confetti animation */
        @keyframes confetti {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(100vh); opacity: 0; }
        }

        .confetti {
            position: fixed;
            top: 0;
            left: 50%;
            width: 10px;
            height: 10px;
            background-color: var(--highlight);
            border-radius: 50%;
            animation: confetti 3s linear infinite;
        }

        /* Add statistics section */
        .stats-container {
            background: var(--card);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px var(--shadow);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: var(--background);
            border-radius: 8px;
        }

        /* Notification Banner Styles */
        .notification-banner {
            background-color: var(--accent);
            color: white;
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideDown 0.5s ease-out;
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .notification-action {
            background-color: white;
            color: var(--accent);
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0 5px;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Vista de Lista Estilos */
        .list-view .presidents-grid {
            display: block;
            margin: 20px 0;
        }

        .list-view .president-card {
            display: grid;
            grid-template-columns: 2fr 2fr 1fr 1fr 2fr;
            gap: 20px;
            align-items: center;
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 8px;
        }

        .list-view .country-header {
            margin: 0;
        }

        .list-view .president-info {
            flex-direction: row;
            margin: 0;
        }

        .list-view .progress-container {
            height: 10px;
            margin: 0;
        }

        .list-view .percentage {
            text-align: left;
            margin: 0;
        }

        .list-view .president-tooltip {
            display: none;
        }

        /* Botón de cambio de vista */
        .view-toggle {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }

        .view-toggle:hover {
            background-color: var(--secondary);
        }

        /* Añadir en la sección de estilos */
        .party-info {
            font-size: 0.85rem;
            color: var(--alternate);
            margin-top: 4px;
            font-style: italic;
        }

        .wiki-btn {
            display: inline-block;
            margin-top: 10px;
            padding: 4px 10px;
            background: var(--alternate);
            color: #fff;
            border-radius: 4px;
            font-size: 0.85rem;
            text-decoration: none;
            transition: background 0.2s;
        }
        .wiki-btn:hover {
            background: var(--primary);
        }

        /* Resaltado de texto buscado */
        mark {
            background-color: #ffe066;
            color: #222;
            padding: 0 2px;
            border-radius: 2px;
        }

        /* Contraste para govt-type en modo oscuro */
        [data-theme="dark"] .govt-type {
            color: #fff;
            background-color: rgba(26, 84, 235, 0.5);
        }

        /* Contorno visible al enfocar input de filtro */
        .country-checkbox input:focus + label {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Mandatos Presidenciales en América Latina y el Caribe</h1>
            <p class="subtitle">Tiempo restante actualizado en tiempo real</p>
        </header>

        <!-- Notification Banner -->
        <div id="notificationBanner" class="notification-banner" style="display: none">
            <div class="notification-content">
                <span id="notificationText"></span>
                <button id="showEndingSoon" class="notification-action">Ver países</button>
            </div>
            <button id="closeNotification" class="notification-close">&times;</button>
        </div>

        <div class="filter-container">
            <div class="filter-header">
                <div class="filter-title">Filtrar países</div>
                <div class="filter-actions">
                    <button id="toggleFilter">Mostrar/Ocultar filtros</button>
                    <button id="selectAll">Seleccionar todos</button>
                    <button id="deselectAll">Deseleccionar todos</button>
                </div>
            </div>

            <div class="region-filter">
                <div class="region-option">
                    <input type="checkbox" id="southAmerica" checked>
                    <label for="southAmerica">América del Sur</label>
                </div>
                <div class="region-option">
                    <input type="checkbox" id="centralAmerica" checked>
                    <label for="centralAmerica">América Central</label>
                </div>
                <div class="region-option">
                    <input type="checkbox" id="caribbean" checked>
                    <label for="caribbean">El Caribe</label>
                </div>
                <div class="region-option">
                    <input type="checkbox" id="northAmerica" checked>
                    <label for="northAmerica">América del Norte</label>
                </div>
            </div>

            <div class="country-filter" id="countryFilter">
                <!-- El contenido será generado dinámicamente por JavaScript -->
            </div>
        </div>

        <div class="controls">
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Buscar por país o presidente..." id="searchInput">
            </div>
            <div class="sort-options">
                <button id="sortByTimeRemaining" class="active">Ordenar por Tiempo Restante</button>
                <button id="sortByCountry">Ordenar por País</button>
                <button id="toggleView" class="view-toggle">
                    <span class="view-icon">📊</span>
                    <span class="view-text">Vista Lista</span>
                </button>
            </div>
            <div class="last-updated">
                Última actualización: <span id="lastUpdatedTime"></span>
            </div>
        </div>

        <!-- Add statistics section -->
        <div class="stats-container">
            <h2>Estadísticas Generales</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <h3>Promedio de Mandato</h3>
                    <div id="avgTerm">Calculando...</div>
                </div>
                <div class="stat-item">
                    <h3>Próximo Cambio</h3>
                    <div id="nextElection">Calculando...</div>
                </div>
                <div class="stat-item">
                    <h3>Mandatos Activos</h3>
                    <div id="activeTerms">Calculando...</div>
                </div>
            </div>
        </div>

        <!-- Selector de columnas para vista de lista -->
        <div id="columnSelector" style="margin-bottom: 20px; display: none;">
            <label style="margin-right: 10px;"><input type="checkbox" id="colCountry" checked> País</label>
            <label style="margin-right: 10px;"><input type="checkbox" id="colPresident" checked> Presidente</label>
            <label style="margin-right: 10px;"><input type="checkbox" id="colParty" checked> Partido</label>
            <label style="margin-right: 10px;"><input type="checkbox" id="colStart" checked> Inicio</label>
            <label style="margin-right: 10px;"><input type="checkbox" id="colEnd" checked> Fin</label>
            <label style="margin-right: 10px;"><input type="checkbox" id="colProgress" checked> Progreso</label>
        </div>
        <div class="presidents-grid" id="presidentsContainer">
            <!-- El contenido será generado dinámicamente por JavaScript -->
        </div>
        <footer>
            <p>Datos actualizados el <span id="lastUpdatedTimeFooter"></span>. La información puede cambiar debido a eventos políticos o electorales.</p>
            <script>
                // Sincroniza la fecha de actualización en el footer
                function updateFooterLastUpdated() {
                    const lastUpdated = document.getElementById('lastUpdatedTime').textContent;
                    document.getElementById('lastUpdatedTimeFooter').textContent = lastUpdated;
                }
                // Actualiza al cargar y cada vez que cambie la cabecera
                setInterval(updateFooterLastUpdated, 1000);
                window.addEventListener('DOMContentLoaded', updateFooterLastUpdated);
            </script>
        </footer>
    </div>

    <!-- Add dark mode toggle -->
    <div class="theme-switch" id="themeSwitch" aria-label="Cambiar tema" title="Cambiar tema">🌓</div>

    <script>
        // Datos de los presidentes (actualizado a marzo de 2025)
        const presidents = [
            {
            country: "Argentina",
            president: "Javier Milei",
            affiliatedMember: "✔️",
            startDate: new Date("2023-12-10"),
            endDate: new Date("2027-12-10"),
            color: "#1A54EB",
            region: "southAmerica",
            politicalParty: "La Libertad Avanza (Derecha)",
            wikipedia: "https://es.wikipedia.org/wiki/Argentina"
            },
            {
            country: "Bolivia",
            president: "Luis Arce",
            affiliatedMember: "✔️",
            startDate: new Date("2020-11-08"),
            endDate: new Date("2025-11-08"),
            color: "#00ADDC",
            region: "southAmerica",
            politicalParty: "Movimiento al Socialismo (Izquierda)"
            },
            {
            country: "Brasil",
            president: "Luiz Inácio Lula da Silva",
            affiliatedMember: "✔️",
            startDate: new Date("2023-01-01"),
            endDate: new Date("2026-12-31"),
            color: "#1A54EB",
            region: "southAmerica",
            politicalParty: "Partido de los Trabajadores (Izquierda)"
            },
            {
            country: "Chile",
            president: "Gabriel Boric",
            affiliatedMember: "✔️",
            startDate: new Date("2022-03-11"),
            endDate: new Date("2026-03-11"),
            color: "#FF5C59",
            region: "southAmerica",
            politicalParty: "Convergencia Social (Izquierda)"
            },
            {
            country: "Colombia",
            president: "Gustavo Petro",
            affiliatedMember: "✔️",
            startDate: new Date("2022-08-07"),
            endDate: new Date("2026-08-07"),
            color: "#FF9700",
            region: "southAmerica",
            politicalParty: "Pacto Histórico (Izquierda)"
            },
            {
            country: "Costa Rica",
            president: "Rodrigo Chaves",
            affiliatedMember: "✔️",
            startDate: new Date("2022-05-08"),
            endDate: new Date("2026-05-08"),
            color: "#00ADDC",
            region: "centralAmerica",
            politicalParty: "Progreso Social Democrático (Centro)"
            },
            {
            country: "Cuba",
            president: "Miguel Díaz-Canel",
            affiliatedMember: "❌",
            startDate: new Date("2023-04-19"),
            endDate: new Date("2028-04-19"),
            color: "#FF5C59",
            region: "caribbean",
            politicalParty: "Partido Comunista de Cuba (Izquierda)"
            },
            {
            country: "Ecuador",
            president: "Daniel Noboa",
            affiliatedMember: "✔️",
            startDate: new Date("2023-11-23"),
            endDate: new Date("2029-05-23"),
            color: "#FF9700",
            region: "southAmerica",
            politicalParty: "Acción Democrática Nacional (Centro-Derecha)"
            },
            {
            country: "El Salvador",
            president: "Nayib Bukele",
            affiliatedMember: "✔️",
            startDate: new Date("2024-06-01"),
            endDate: new Date("2029-06-01"),
            color: "#00115B",
            region: "centralAmerica",
            politicalParty: "Nuevas Ideas (Derecha)"
            },
            {
            country: "Guatemala",
            president: "Bernardo Arévalo",
            affiliatedMember: "✔️",
            startDate: new Date("2024-01-14"),
            endDate: new Date("2028-01-14"),
            color: "#00ADDC",
            region: "centralAmerica",
            politicalParty: "Movimiento Semilla (Centro-Izquierda)"
            },
            {
            country: "Honduras",
            president: "Xiomara Castro",
            affiliatedMember: "✔️",
            startDate: new Date("2022-01-27"),
            endDate: new Date("2026-01-27"),
            color: "#1A54EB",
            region: "centralAmerica",
            politicalParty: "Partido Libertad y Refundación (Izquierda)"
            },
            {
            country: "México",
            president: "Claudia Sheinbaum",
            affiliatedMember: "✔️",
            startDate: new Date("2024-10-01"),
            endDate: new Date("2030-09-30"),
            color: "#00115B",
            region: "northAmerica",
            politicalParty: "Movimiento Regeneración Nacional (Izquierda)"
            },
            {
            country: "Nicaragua",
            president: "Daniel Ortega",
            affiliatedMember: "❌",
            startDate: new Date("2022-01-10"),
            endDate: new Date("2027-01-10"),
            color: "#66719B",
            region: "centralAmerica",
            politicalParty: "Frente Sandinista de Liberación Nacional (Izquierda)"
            },
            {
            country: "Panamá",
            president: "José Raúl Mulino",
            affiliatedMember: "✔️",
            startDate: new Date("2024-07-01"),
            endDate: new Date("2029-06-30"),
            color: "#FF5C59",
            region: "centralAmerica",
            politicalParty: "Cambio Democrático (Centro-Derecha)"
            },
            {
            country: "Paraguay",
            president: "Santiago Peña",
            affiliatedMember: "✔️",
            startDate: new Date("2023-08-15"),
            endDate: new Date("2028-08-15"),
            color: "#FF5C59",
            region: "southAmerica",
            politicalParty: "Partido Colorado (Derecha)"
            },
            {
            country: "Perú",
            president: "Dina Boluarte",
            affiliatedMember: "✔️",
            startDate: new Date("2022-12-07"),
            endDate: new Date("2026-07-28"),
            color: "#FF5C59",
            region: "southAmerica",
            politicalParty: "Independiente (Centro)"
            },
            {
            country: "República Dominicana",
            president: "Luis Abinader",
            affiliatedMember: "✔️",
            startDate: new Date("2024-08-16"),
            endDate: new Date("2028-08-16"),
            color: "#00115B",
            region: "caribbean",
            politicalParty: "Partido Revolucionario Moderno (Centro-Derecha)"
            },
            {
            country: "Uruguay",
            president: "Yamandú Orsi",
            affiliatedMember: "✔️",
            startDate: new Date("2025-03-01"),
            endDate: new Date("2030-03-01"),
            color: "#1A54EB",
            region: "southAmerica",
            politicalParty: "Partido Nacional (Centro-Derecha)"
            },
            {
            country: "Venezuela",
            president: "Nicolás Maduro",
            affiliatedMember: "❌",
            startDate: new Date("2019-01-10"),
            endDate: new Date("2025-01-10"),
            color: "#FF9700",
            region: "southAmerica",
            politicalParty: "Partido Socialista Unido de Venezuela (Izquierda)"
            },
            {
            country: "Jamaica",
            president: "Andrew Holness",
            affiliatedMember: "✔️",
            startDate: new Date("2020-09-03"),
            endDate: new Date("2025-09-03"),
            color: "#99A0BE",
            region: "caribbean",
            politicalParty: "Partido Laborista de Jamaica (Centro-Derecha)"
            },
            {
            country: "Trinidad y Tobago",
            president: "Stuart Young",
            affiliatedMember: "✔️",
            startDate: new Date("2025-03-17"),
            endDate: new Date("2030-03-17"),
            color: "#66719B",
            region: "caribbean",
            politicalParty: "Movimiento Nacional del Pueblo (Centro)"
            }
        ];

        // Estado de los filtros
        const selectedCountries = new Set(presidents.map(p => p.country));
        const selectedRegions = new Set(['southAmerica', 'centralAmerica', 'caribbean', 'northAmerica']);

        // Añadir después de las variables globales
        let isListView = false;

        // Función para calcular el tiempo restante
        function calculateTimeRemaining(endDate) {
            const now = new Date();
            let diff = endDate - now;

            // Si ya pasó la fecha
            if (diff <= 0) {
                return {
                    expired: true,
                    years: 0,
                    months: 0,
                    days: 0,
                    percentage: 0
                };
            }
            
            // Convertir a días, meses y años
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const years = Math.floor(days / 365);
            const months = Math.floor((days % 365) / 30);
            const remainingDays = days % 30;
            
            // Calcular el porcentaje de tiempo transcurrido
            const totalDuration = endDate - new Date(Date.parse(presidents.find(p => p.endDate === endDate).startDate));
            const elapsedDuration = now - new Date(Date.parse(presidents.find(p => p.endDate === endDate).startDate));
            const percentage = 100 - Math.min(100, Math.floor((elapsedDuration / totalDuration) * 100));

            return {
                expired: false,
                years: years,
                months: months,
                days: remainingDays,
                percentage: percentage
            };
        }

        // Añadir esta función antes de renderPresidents
        function getCountryCode(country) {
            const codes = {
                'Argentina': 'ar',
                'Bolivia': 'bo',
                'Brasil': 'br',
                'Chile': 'cl',
                'Colombia': 'co',
                'Costa Rica': 'cr',
                'Cuba': 'cu',
                'Ecuador': 'ec',
                'El Salvador': 'sv',
                'Guatemala': 'gt',
                'Honduras': 'hn',
                'México': 'mx',
                'Nicaragua': 'ni',
                'Panamá': 'pa',
                'Paraguay': 'py',
                'Perú': 'pe',
                'República Dominicana': 'do',
                'Uruguay': 'uy',
                'Venezuela': 've',
                'Jamaica': 'jm',
                'Trinidad y Tobago': 'tt'
            };
            return codes[country] || '';
        }

        // Función para resaltar texto buscado
        function highlightText(text, term) {
            if (!term) return text;
            const regex = new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return text.replace(regex, '<mark>$1</mark>');
        }

        // Función para formatear fecha como DD/MM/AAAA
        function formatDate(date) {
            const d = new Date(date);
            const day = String(d.getDate()).padStart(2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = d.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Función para obtener columnas seleccionadas
        function getSelectedColumns() {
            return {
                country: document.getElementById('colCountry')?.checked ?? true,
                president: document.getElementById('colPresident')?.checked ?? true,
                party: document.getElementById('colParty')?.checked ?? true,
                start: document.getElementById('colStart')?.checked ?? true,
                end: document.getElementById('colEnd')?.checked ?? true,
                progress: document.getElementById('colProgress')?.checked ?? true
            };
        }

        // Modificar la función renderPresidents
        function renderPresidents(sortedList) {
            const container = document.getElementById('presidentsContainer');
            container.innerHTML = '';
            
            // Actualizar clase del contenedor según la vista
            document.body.classList.toggle('list-view', isListView);
            
            // Obtener término de búsqueda actual
            const searchInput = document.getElementById('searchInput');
            const searchTerm = searchInput ? searchInput.value.trim().toLowerCase() : '';
            
            // Filtrar la lista según los países seleccionados
            const filteredList = sortedList.filter(president => 
                selectedCountries.has(president.country) && 
                selectedRegions.has(president.region)
            );
            
            if (filteredList.length === 0) {
                const noResults = document.createElement('div');
                noResults.className = 'president-card';
                noResults.innerHTML = '<p style="text-align: center;">No hay países seleccionados que coincidan con los filtros.</p>';
                container.appendChild(noResults);
                return;
            }
            
            // Leer columnas seleccionadas si es vista de lista
            let cols = {
                country: true, president: true, party: true, start: true, end: true, progress: true
            };
            if (isListView) {
                cols = getSelectedColumns();
            }

            // Si es vista de lista, renderizar encabezado de columnas
            if (isListView) {
                const header = document.createElement('div');
                header.className = 'president-card';
                header.style.fontWeight = 'bold';
                header.style.background = 'var(--background)';
                header.style.display = 'flex';
                header.style.gap = '20px';
                header.style.alignItems = 'center';
                header.style.marginBottom = '5px';
                if (cols.country) header.appendChild(Object.assign(document.createElement('div'), {textContent: 'País', style: 'flex:1;'}));
                if (cols.president) header.appendChild(Object.assign(document.createElement('div'), {textContent: 'Presidente', style: 'flex:1;'}));
                if (cols.party) header.appendChild(Object.assign(document.createElement('div'), {textContent: 'Partido', style: 'flex:1;'}));
                if (cols.start) header.appendChild(Object.assign(document.createElement('div'), {textContent: 'Inicio', style: 'flex:1;'}));
                if (cols.end) header.appendChild(Object.assign(document.createElement('div'), {textContent: 'Fin', style: 'flex:1;'}));
                if (cols.progress) header.appendChild(Object.assign(document.createElement('div'), {textContent: 'Progreso', style: 'flex:1;'}));
                container.appendChild(header);
            }

            filteredList.forEach(president => {
                const timeRemaining = calculateTimeRemaining(president.endDate);
                
                const card = document.createElement('div');
                card.className = 'president-card';
                
                // Calcula los días totales restantes
                const totalDaysRemaining = (timeRemaining.years * 365) + (timeRemaining.months * 30) + timeRemaining.days;
                
                // Aplica la clase solo si quedan 90 días o menos
                if (!timeRemaining.expired && totalDaysRemaining <= 90) {
                    card.classList.add('ending-soon');
                }

                // Resaltado de texto buscado
                const highlightedCountry = highlightText(president.country, searchTerm);
                const highlightedPresident = highlightText(president.president, searchTerm);

                if (isListView) {
                    // Vista de lista: columnas dinámicas
                    card.style.display = 'flex';
                    card.style.gap = '20px';
                    card.style.alignItems = 'center';
                    card.style.marginBottom = '10px';
                    card.style.borderRadius = '8px';
                    card.style.padding = '10px 15px';

                    if (cols.country) {
                        const countryDiv = document.createElement('div');
                        countryDiv.style.flex = '1';
                        countryDiv.innerHTML = `<img class="country-flag" src="https://flagcdn.com/w20/${getCountryCode(president.country)}.png" alt="Bandera de ${president.country}" loading="lazy" style="vertical-align:middle;margin-right:5px;">${highlightedCountry}`;
                        card.appendChild(countryDiv);
                    }
                    if (cols.president) {
                        const presDiv = document.createElement('div');
                        presDiv.style.flex = '1';
                        presDiv.innerHTML = highlightedPresident;
                        card.appendChild(presDiv);
                    }
                    if (cols.party) {
                        const partyDiv = document.createElement('div');
                        partyDiv.style.flex = '1';
                        partyDiv.textContent = president.politicalParty;
                        card.appendChild(partyDiv);
                    }
                    if (cols.start) {
                        const startDiv = document.createElement('div');
                        startDiv.style.flex = '1';
                        startDiv.textContent = formatDate(president.startDate);
                        card.appendChild(startDiv);
                    }
                    if (cols.end) {
                        const endDiv = document.createElement('div');
                        endDiv.style.flex = '1';
                        endDiv.textContent = formatDate(president.endDate);
                        card.appendChild(endDiv);
                    }
                    if (cols.progress) {
                        const progDiv = document.createElement('div');
                        progDiv.style.flex = '1';
                        progDiv.innerHTML = `
                            <div class="progress-container" style="height:10px;margin:0;">
                                <div class="progress-bar" style="width: ${timeRemaining.percentage}%"></div>
                            </div>
                            <div class="percentage" style="font-size:0.85rem;">${timeRemaining.percentage}%</div>
                        `;
                        card.appendChild(progDiv);
                    }
                } else {
                    const countryHeader = document.createElement('div');
                    countryHeader.className = 'country-header';
                    
                    const countryName = document.createElement('div');
                    countryName.className = 'country-name';
                    
                    const flag = document.createElement('img');
                    flag.className = 'country-flag';
                    flag.src = `https://flagcdn.com/w40/${getCountryCode(president.country)}.png`;
                    flag.alt = `Bandera de ${president.country}`;
                    flag.loading = 'lazy';
                    
                    countryName.appendChild(flag);
                    // Resaltado de país
                    const countrySpan = document.createElement('span');
                    countrySpan.innerHTML = highlightedCountry;
                    countryName.appendChild(countrySpan);
                    
                    const govtType = document.createElement('div');
                    govtType.className = 'govt-type';
                    govtType.textContent = president.affiliatedMember;
                    
                    countryHeader.appendChild(countryName);
                    countryHeader.appendChild(govtType);
                    
                    const presidentInfo = document.createElement('div');
                    presidentInfo.className = 'president-info';
                    
                    const presidentName = document.createElement('div');
                    presidentName.className = 'president-name';
                    // Resaltado de presidente
                    presidentName.innerHTML = highlightedPresident;

                    const partyInfo = document.createElement('div');
                    partyInfo.className = 'party-info';
                    partyInfo.textContent = president.politicalParty;
                    
                    presidentInfo.appendChild(presidentName);
                    presidentInfo.appendChild(partyInfo);
                    
                    const timeText = document.createElement('div');
                    timeText.className = 'time-remaining';
                    
                    if (timeRemaining.expired) {
                        timeText.textContent = 'Mandato expirado';
                        timeText.classList.add('expired');
                    } else {
                        // Formatear el tiempo restante
                        let timeString = '';
                        if (timeRemaining.years > 0) {
                            timeString += `${timeRemaining.years} año${timeRemaining.years !== 1 ? 's' : ''}`;
                        }
                        if (timeRemaining.months > 0) {
                            timeString += timeRemaining.years > 0 ? ' y ' : '';
                            timeString += `${timeRemaining.months} mes${timeRemaining.months !== 1 ? 'es' : ''}`;
                        }
                        if (timeRemaining.years === 0 && timeRemaining.months === 0) {
                            timeString = `${timeRemaining.days} día${timeRemaining.days !== 1 ? 's' : ''}`;
                        }
                        timeText.textContent = timeString; 
                    }
                                    
                    presidentInfo.appendChild(timeText);
                    
                    // Add dates info
                    const datesInfo = document.createElement('div');
                    datesInfo.style.fontSize = '0.9rem';
                    datesInfo.style.color = 'var(--alternate)';
                    datesInfo.style.marginTop = '5px';
                    datesInfo.textContent = `Mandato: ${formatDate(president.startDate)} - ${formatDate(president.endDate)}`;
                    
                    presidentInfo.appendChild(datesInfo);
                    
                    const progressContainer = document.createElement('div');
                    progressContainer.className = 'progress-container';
                    
                    const progressBar = document.createElement('div');
                    progressBar.className = 'progress-bar';
                    progressBar.style.width = `${timeRemaining.percentage}%`;
                    
                    progressContainer.appendChild(progressBar);
                    
                    const percentage = document.createElement('div');
                    percentage.className = 'percentage';
                    percentage.textContent = `${timeRemaining.percentage}% restante`;
                    
                    const tooltip = document.createElement('div');
                    tooltip.className = 'president-tooltip';
                    tooltip.setAttribute('role', 'tooltip');
                    tooltip.textContent = `Inicio: ${formatDate(president.startDate)} - Fin: ${formatDate(president.endDate)}`;
                    
                    card.appendChild(countryHeader);
                    card.appendChild(presidentInfo);
                    card.appendChild(progressContainer);
                    card.appendChild(percentage);
                    card.appendChild(tooltip);

                    // Dentro de la función que crea cada tarjeta de presidente
                    const wikiBtn = document.createElement('a');
                    wikiBtn.href = president.wikipedia || `https://es.wikipedia.org/wiki/${encodeURIComponent(president.country)}`;
                    wikiBtn.target = "_blank";
                    wikiBtn.rel = "noopener noreferrer";
                    wikiBtn.className = "wiki-btn";
                    wikiBtn.title = `Ver ${president.country} en Wikipedia`;
                    wikiBtn.innerHTML = '🌐 Wikipedia';

                    card.appendChild(wikiBtn);
                }
                
                container.appendChild(card);
            });
        }

        // Añadir el event listener para el botón de cambio de vista
        document.getElementById('toggleView').addEventListener('click', function() {
            isListView = !isListView;
            const viewIcon = this.querySelector('.view-icon');
            const viewText = this.querySelector('.view-text');
            // Mostrar/ocultar selector de columnas
            document.getElementById('columnSelector').style.display = isListView ? 'block' : 'none';
            if (isListView) {
                viewIcon.textContent = '🗃️';
                viewText.textContent = 'Vista Tarjetas';
            } else {
                viewIcon.textContent = '📊';
                viewText.textContent = 'Vista Lista';
            }
            renderPresidents(
                document.getElementById('sortByTimeRemaining').classList.contains('active')
                ? sortByTimeRemaining()
                : sortByCountryName()
            );
        });

        // Función para generar los checkboxes de países
        function generateCountryFilter() {
            const filterContainer = document.getElementById('countryFilter');
            filterContainer.innerHTML = '';
            
            // Ordenar alfabéticamente los países
            const sortedCountries = [...presidents].sort((a, b) => a.country.localeCompare(b.country));
            sortedCountries.forEach(president => {
                const checkbox = document.createElement('div');
                checkbox.className = 'country-checkbox';
                
                // Generar id único y seguro
                const inputId = `country-${president.country.replace(/\s+/g, '-').toLowerCase()}`;

                const input = document.createElement('input');
                input.type = 'checkbox';
                input.id = inputId;
                input.checked = selectedCountries.has(president.country);
                input.dataset.country = president.country;
                input.setAttribute('aria-label', `Filtrar por ${president.country}`);
                
                input.addEventListener('change', function() {
                    if (this.checked) {
                        selectedCountries.add(president.country);
                    } else {
                        selectedCountries.delete(president.country);
                    }
                    
                    renderPresidents(
                        document.getElementById('sortByTimeRemaining').classList.contains('active') 
                        ? sortByTimeRemaining() 
                        : sortByCountryName()
                    );
                });
                
                const label = document.createElement('label');
                label.htmlFor = inputId;
                label.textContent = president.country;
                
                checkbox.appendChild(input);
                checkbox.appendChild(label);
                
                filterContainer.appendChild(checkbox);
            });
        }

        // Función para actualizar la hora de última actualización
        function updateLastUpdated() {
            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            const hour = String(now.getHours()).padStart(2, '0');
            const minute = String(now.getMinutes()).padStart(2, '0');
            const second = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('lastUpdatedTime').textContent = `${day}/${month}/${year} ${hour}:${minute}:${second}`;
        }

        // Ordenar por tiempo restante (por defecto)
        function sortByTimeRemaining() {
            return [...presidents].sort((a, b) => {
                const timeA = calculateTimeRemaining(a.endDate);
                const timeB = calculateTimeRemaining(b.endDate);
                
                if (timeA.expired && !timeB.expired) return 1;
                if (!timeA.expired && timeB.expired) return -1;
                
                const totalDaysA = (timeA.years * 365) + (timeA.months * 30) + timeA.days;
                const totalDaysB = (timeB.years * 365) + (timeB.months * 30) + timeB.days;
                
                return totalDaysA - totalDaysB;
            });
        }

        // Ordenar por país
        function sortByCountryName() {
            return [...presidents].sort((a, b) => a.country.localeCompare(b.country));
        }

        // Event listeners para los botones de ordenamiento
        document.getElementById('sortByTimeRemaining').addEventListener('click', function() {
            this.classList.add('active');
            document.getElementById('sortByCountry').classList.remove('active');
            renderPresidents(sortByTimeRemaining());
        });

        document.getElementById('sortByCountry').addEventListener('click', function() {
            this.classList.add('active');
            document.getElementById('sortByTimeRemaining').classList.remove('active');
            renderPresidents(sortByCountryName());
        });

        // Event listener para mostrar/ocultar filtros
        document.getElementById('toggleFilter').addEventListener('click', function() {
            const filterContainer = document.getElementById('countryFilter');
            filterContainer.classList.toggle('show');
        });

        // Event listeners para los botones de selección de países
        document.getElementById('selectAll').addEventListener('click', function() {
            presidents.forEach(president => {
                selectedCountries.add(president.country);
                const checkbox = document.getElementById(`country-${president.country.replace(/\s+/g, '-').toLowerCase()}`);
                if (checkbox) checkbox.checked = true;
            });
            
            renderPresidents(
                document.getElementById('sortByTimeRemaining').classList.contains('active') 
                ? sortByTimeRemaining() 
                : sortByCountryName()
            );
        });

        document.getElementById('deselectAll').addEventListener('click', function() {
            selectedCountries.clear();
            presidents.forEach(president => {
                const checkbox = document.getElementById(`country-${president.country.replace(/\s+/g, '-').toLowerCase()}`);
                if (checkbox) checkbox.checked = false;
            });
            
            renderPresidents(
                document.getElementById('sortByTimeRemaining').classList.contains('active') 
                ? sortByTimeRemaining() 
                : sortByCountryName()
            );
        });

        // Event listeners para los filtros por región
        document.querySelectorAll('.region-option input').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const region = this.id;
                
                if (this.checked) {
                    selectedRegions.add(region);
                } else {
                    selectedRegions.delete(region);
                }
                
                renderPresidents(
                    document.getElementById('sortByTimeRemaining').classList.contains('active') 
                    ? sortByTimeRemaining() 
                    : sortByCountryName()
                );
            });
        });

        // Add search functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const filteredPresidents = presidents.filter(president => 
                president.country.toLowerCase().includes(searchTerm) ||
                president.president.toLowerCase().includes(searchTerm)
            );
            renderPresidents(filteredPresidents);
        });

        // Add statistics calculations
        function updateStatistics() {
            const now = new Date();
            
            // Calculate average term
            const avgTermMonths = presidents.reduce((acc, pres) => {
                const term = pres.endDate - pres.startDate;
                return acc + (term / (1000 * 60 * 60 * 24 * 30));
            }, 0) / presidents.length;
            
            document.getElementById('avgTerm').textContent = 
                `${Math.round(avgTermMonths)} meses`;
            
            // Find next election
            const nextEnd = presidents
                .map(p => p.endDate)
                .filter(date => date > now)
                .sort((a, b) => a - b)[0];
            
            document.getElementById('nextElection').textContent = 
                nextEnd ? formatDate(nextEnd) : 'No hay datos';
            
            // Count active terms
            const activeTerms = presidents.filter(p => 
                p.startDate <= now && p.endDate >= now
            ).length;
            
            document.getElementById('activeTerms').textContent = 
                `${activeTerms} de ${presidents.length}`;
        }

        // Add notification system
        function checkEndingSoonMandates() {
            const now = new Date();
            const threeMonthsFromNow = new Date(now.getTime() + (90 * 24 * 60 * 60 * 1000));
            
            const endingSoon = presidents.filter(president => {
                const endDate = new Date(president.endDate);
                return endDate > now && endDate <= threeMonthsFromNow;
            });

            const banner = document.getElementById('notificationBanner');
            const notificationText = document.getElementById('notificationText');

            if (endingSoon.length > 0) {
                notificationText.textContent = `${endingSoon.length} mandato${endingSoon.length > 1 ? 's' : ''} presidencial${endingSoon.length > 1 ? 'es' : ''} termina${endingSoon.length > 1 ? 'n' : ''} en los próximos 3 meses`;
                banner.style.display = 'flex';
            } else {
                banner.style.display = 'none';
            }
        }

        // Add event listeners for notification system
        document.getElementById('showEndingSoon').addEventListener('click', function() {
            const now = new Date();
            const threeMonthsFromNow = new Date(now.getTime() + (90 * 24 * 60 * 60 * 1000));
            
            // Filter presidents ending soon
            const endingSoon = presidents.filter(president => {
                const endDate = new Date(president.endDate);
                return endDate > now && endDate <= threeMonthsFromNow;
            });

            // Update selected countries to show only ending soon
            selectedCountries.clear();
            endingSoon.forEach(president => {
                selectedCountries.add(president.country);
            });

            // Update checkboxes
            document.querySelectorAll('.country-checkbox input').forEach(checkbox => {
                checkbox.checked = selectedCountries.has(checkbox.dataset.country);
            });

            // Render presidents with time remaining sort
            renderPresidents(sortByTimeRemaining());
        });

        document.getElementById('closeNotification').addEventListener('click', function() {
            document.getElementById('notificationBanner').style.display = 'none';
        });

        // Event listeners para los checkboxes del selector de columnas
        document.querySelectorAll('#columnSelector input[type="checkbox"]').forEach(cb => {
            cb.addEventListener('change', function() {
                if (isListView) {
                    renderPresidents(
                        document.getElementById('sortByTimeRemaining').classList.contains('active')
                        ? sortByTimeRemaining()
                        : sortByCountryName()
                    );
                }
            });
        });

        // Inicializar la página
        function init() {
            generateCountryFilter();
            document.getElementById('countryFilter').classList.add('show'); // Mostrar filtros por defecto
            // Mostrar selector de columnas si inicia en vista de lista
            document.getElementById('columnSelector').style.display = isListView ? 'block' : 'none';
            renderPresidents(sortByTimeRemaining());
            updateLastUpdated();
            updateStatistics();
            checkEndingSoonMandates();
            
            // Actualizar cada minuto
            setInterval(function() {
                renderPresidents(
                    document.getElementById('sortByTimeRemaining').classList.contains('active') 
                    ? sortByTimeRemaining() 
                    : sortByCountryName()
                );
                updateLastUpdated();
                updateStatistics();
                checkEndingSoonMandates();
            }, 60000);
        }

        // Add dark mode toggle functionality
        const themeSwitch = document.getElementById('themeSwitch');
        themeSwitch.addEventListener('click', () => {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', newTheme);
            themeSwitch.textContent = newTheme === 'dark' ? '☀️' : '🌙';
        });

        // Initialize theme
        document.body.setAttribute('data-theme', 'light');

        // Cargar la página
        window.onload = init;
    </script>
</body>
</html>